FROM ubuntu:xenial


ENV HOME /galactrum

ENV USER_ID ${USER_ID:-1000}
ENV GROUP_ID ${GROUP_ID:-1000}

RUN groupadd -g ${GROUP_ID} galactrum \
        && useradd -u ${USER_ID} -g galactrum -s /bin/bash -m -d /galactrum galactrum

RUN apt-get update && apt-get install -y --no-install-recommends \
  wget git net-tools build-essential libtool autotools-dev automake pkg-config
RUN wget  --no-check-certificate https://github.com/galactrum/galactrum/releases/download/v1.1.3/galactrum-1.1.3-linux64.tar.gz
RUN tar -xvzf galactrum-1.1.3-linux64.tar.gz
RUN mv galactrum-1.1.3/bin/* /usr/local/bin/
RUN cd /tmp/ && GIT_SSL_NO_VERIFY=true git clone https://github.com/tpruvot/yiimp.git \
  && cd /tmp/yiimp/blocknotify \
  && make \
  && cp blocknotify /usr/local/bin/ \
  && cp blocknotify /bin/
ENV PATH="/usr/local/bin/:${PATH}"

VOLUME ["/galactrum"]

RUN ln -s /galactrum/.galactrum /root/.galactrum

#RUN /usr/local/bin/galactrumd -printtoconsole
EXPOSE 6269 6270
CMD galactrumd -printtoconsole ; sleep infinity
